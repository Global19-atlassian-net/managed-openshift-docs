// Module included in the following assemblies:
//
// * assemblies/osd-policy-ccs-requirements.adoc

[id="gcp-policy-ccs_{context}"]
= Requirements for Google Cloud

Red Hat recommends the usage of a Google Cloud project, managed by the customer, to organize all of your Google Cloud resources. A project consists of a set of users; a set of APIs; and billing, authentication, and monitoring settings for those APIs.

It is a best practice for the {product-title} CCS cluster to be hosted in a Google Cloud project within a Google Cloud organization. The Organization resource is the root node of the Google Cloud resource hierarchy and all resources that belong to an organization are grouped under the organization node. An IAM service account with certain roles granted is created and applied to the Google Cloud project. When you make calls to the API, you typically provide service account keys for authentication. Each service account is owned by a specific project, but service accounts can be provided roles to access resources for other projects.

== Customer procedure

1. link:https://cloud.google.com/resource-manager/docs/creating-managing-projects[Create a Google Cloud project] to host the {product-title} cluster. Note: The project name must be 10 characters or less.
2. link:https://cloud.google.com/service-usage/docs/enable-disable#enabling[Enable ] the following required APIs in the project that hosts your {product-title} cluster:
+
.Required API services
[cols="2a,3a",options="header"]
|===
|API service |Console service name

ifdef::template[]
|Cloud Deployment Manager V2 API
|`deploymentmanager.googleapis.com`
endif::template[]

|Compute Engine API
|`compute.googleapis.com`

|Google Cloud APIs
|`cloudapis.googleapis.com`

|Cloud Resource Manager API
|`cloudresourcemanager.googleapis.com`

|Google DNS API
|`dns.googleapis.com`

|IAM Service Account Credentials API
|`iamcredentials.googleapis.com`

|Identity and Access Management (IAM) API
|`iam.googleapis.com`

|Service Management API
|`servicemanagement.googleapis.com`

|Service Usage API
|`serviceusage.googleapis.com`

|Google Cloud Storage JSON API
|`storage-api.googleapis.com`

|Cloud Storage
|`storage-component.googleapis.com`

|===

3. To ensure that Red Hat can perform necessary actions, you must create an `osd-ccs-admin` IAM link:https://cloud.google.com/iam/docs/creating-managing-service-accounts#creating_a_service_account[service account] user within the Google Cloud project. The following roles must be link:https://cloud.google.com/iam/docs/granting-roles-to-service-accounts#granting_access_to_a_service_account_for_a_resource[granted to the service account]:
+
.Required roles
[cols="2a,3a",options="header"]

|===

|Role|Console role name

|Compute Admin
|`roles/compute.admin`

|DNS Admin
|`roles/dns.admin`

|Organizational Policy Viewer
|`roles/orgpolicy.policyViewer`

|Owner
|`roles/owner`

|Project Deleter
|`roles/resourcemanager.projectDeleter`

|Project IAM Admin
|`roles/resourcemanager.projectIamAdmin`

|Service Management Administrator
|`roles/servicemanagement.admin`

|Service Usage Admin
|`roles/serviceusage.serviceUsageAdmin`

|Storage Admin
|`roles/storage.admin`


|===

4. link:https://cloud.google.com/iam/docs/creating-managing-service-account-keys#creating_service_account_keys[Create the service account key] for the `osd-ccs-admin` IAM service account. Export the key to a file named `osServiceAccount.json`, this JSON file will be uploaded in OpenShift Cluster Manager (OCM) when you create your cluster.


= Red Hat managed Google Cloud resources

== IAM Users

- The `osd-managed-admin` IAM service account is created immediately after taking control of the customer-provided Google Cloud account. This is the user that will be performing the {product-title} cluster install.

== IAM roles

[cols="2a,3a,2a",options="header"]

|===

|Role |Console role name |Description

|Compute Admin
|`roles/compute.admin`
|Provides full control of all Compute Engine resources.

|DNS Administrator
|`roles/dns.admin`
|Provides read-write access to all Cloud DNS resources.

|Security Admin
|`roles/iam.securityAdmin`
|Security admin role, with permissions to get and set any IAM policy.

|Storage Admin
|`roles/storage.admin`
|Grants full control of objects and buckets.

When applied to an individual *bucket*, control applies only to the specified bucket and objects within the bucket.

|Service Account Admin
|`roles/iam.serviceAccountAdmin`
|Create and manage service accounts.

|Service Account Key Admin
|`roles/iam.serviceAccountKeyAdmin`
|Create and manage (and rotate) service account keys.

|Service Account User
|`roles/iam.serviceAccountUser`
|Run operations as the service account.

|===

== Provisioned Google Cloud Infrastructure
